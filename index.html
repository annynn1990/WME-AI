<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>御子-AI 監控面板</title>
    <style>
        body { background: #36393f; color: #fff; font-family: sans-serif; padding: 20px; }
        #chat { background: #2f3136; height: 80vh; overflow-y: auto; padding: 15px; border-radius: 8px; border: 1px solid #444; }
        .msg { border-bottom: 1px solid #40444b; padding: 8px 0; }
        .user { color: #00aff4; font-weight: bold; }
        .error { color: #ff4747; background: #202225; padding: 10px; border-radius: 5px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div id="err-log" class="error" style="display:none"></div>
    <div id="chat">正在連線至 Discord API... (請確保 Bot 的 Message Intent 已開啟並存檔)</div>

    <script>
        const TOKEN = 'MTQ3NjU4MTQxNTI4NTAzMTAw.GwEt_a.2SCtDXHuBntzvMDvYyfYzGyc71bRmzBwkMpdxU';
        const CHANNEL = '1476579447271587890';

        async function update() {
            try {
                const api = `https://discord.com/api/v10/channels/${CHANNEL}/messages?limit=20`;
                const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(api)}`);
                const wrapper = await res.json();
                const data = JSON.parse(wrapper.contents);

                if (data.code === 50001) {
                    throw new Error("機器人權限不足：請確認機器人是否在頻道內，且 Intent 已開啟並存檔。");
                }
                if (data.message === "401: Unauthorized") {
                    throw new Error("Token 失效：請在 Discord 後台 Reset Token 並更新網頁程式碼。");
                }

                if (Array.isArray(data)) {
                    document.getElementById('err-log').style.display = 'none';
                    document.getElementById('chat').innerHTML = data.reverse().map(m => `
                        <div class="msg"><span class="user">${m.author.username}</span>: ${m.content || '(媒體)'}</div>
                    `).join('');
                }
            } catch (e) {
                document.getElementById('err-log').style.display = 'block';
                document.getElementById('err-log').innerText = "連線失敗：" + e.message;
            }
        }
        setInterval(update, 5000);
        update();
    </script>
</body>
</html>
